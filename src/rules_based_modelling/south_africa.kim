private namespace rules_based_modelling.south_africa
using nca.ecosystem.iucn, nca.ecoregion, rules_based_modelling, data;

model local:alessio.bulckaen:esa.aries.sandbox:esa_weed.cu_glc_fcs30d_landcover_epsg4326_30m_2020,
	local:alessio.bulckaen:esa.aries.sandbox:esa_weed.cu_glc_fcs30d_landcover_epsg4326_30m_2021,
	local:alessio.bulckaen:esa.aries.sandbox:esa_weed.cu_glc_fcs30d_landcover_epsg4326_30m_2022
	as landcover:LandCoverType classified according to im:glc-fcs30-enconding;

model 'local:rubencc:im.data.global:im-data-global-ecology.global_ecoregions_300m_4326_2017'
	as type of nca.ecoregion:DinersteinRegion classified into
		nca.ecoregion:AlbanyThicket if 88,
		nca.ecoregion:FynbosShrubland if 89,
		nca.ecoregion:RenosterveldShrubland if 90,
		nca.ecoregion:SucculentKarooXericShrubland if 110;

model local:alessio.bulckaen:im.data.global:im-data-global-agriculture.global_forest_management_100m_2015_v3_2
	as rules_based_modelling:ForestType classified into
		rules_based_modelling:PrimaryForest if 11,
		rules_based_modelling:SecondaryForest if 20,
		rules_based_modelling:PlantedForest if 31,
			rules_based_modelling:TimberPlantation if 32,
			rules_based_modelling:OilPalmPlantation if 40,
			rules_based_modelling:Agroforestry if 53;

define RULE_BASED_ECOSYSTEM_IUCN_TABLE as {{ 
          landcover           |              forest_managment              |          dinerstein_ecoregion                |additonal_variable	|                        ecosystem_type                        
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 landcover:Forest             | rules_based_modelling:PlantedForest        | #                                            | #     				|  nca.ecosystem.iucn:Plantation                               , 
 #                            | rules_based_modelling:TimberPlantation     | #                                            | #     				|  nca.ecosystem.iucn:Plantation                               , 
 #                            | rules_based_modelling:OilPalmPlantation    | #                                            | #     				|  nca.ecosystem.iucn:Plantation                               , 
 #                            | rules_based_modelling:Agroforestry         | #                                            | #     				|  nca.ecosystem.iucn:Plantation                               ,
 landcover:Shrubland	      | #                                          | nca.ecoregion:FynbosShrubland                | #   				|  nca.ecosystem.iucn:SeasonallyDryTemperateHeathShrubland     ,
 landcover:SparseVegetation   | #                                          | nca.ecoregion:RenosterveldShrubland          | #   				|  nca.ecosystem.iucn:SeasonallyDryTemperateHeathShrubland     ,
 landcover:Shrubland	      | #                                          | nca.ecoregion:RenosterveldShrubland          | #   				|  nca.ecosystem.iucn:SeasonallyDryTemperateHeathShrubland     ,
 landcover:Forest		      | #                                          | nca.ecoregion:FynbosShrubland          	  | #   				|  nca.ecosystem.iucn:SeasonallyDryTemperateHeathShrubland     ,
 landcover:Grassland	      | #                                          | #									          | #   				|  nca.ecosystem.iucn:DerivedSeminaturalPastureOldfield        ,
 landcover:Shrubland	      | #                                          | nca.ecoregion:SucculentKarooXericShrubland   | #   				|  nca.ecosystem.iucn:TropicalSubtropicalDryForestThicket      , 
 #                            | #                                          | nca.ecoregion:AlbanyThicket                  | #   				|  nca.ecosystem.iucn:TropicalSubtropicalDryForestThicket      , 
 #                            | #                                          | nca.ecoregion:AlbanyThicket                  | #   				|  nca.ecosystem.iucn:TropicalSubtropicalDryForestThicket      , 
 landcover:SparseVegetation   | #                                          | nca.ecoregion:FynbosShrubland                | #   				|  nca.ecosystem.iucn:ThornyDesertSemidesert                   , 
 landcover:SparseVegetation   | #                                          | nca.ecoregion:SucculentKarooXericShrubland   | #   				|  nca.ecosystem.iucn:ThornyDesertSemidesert                   , 
 landcover:SparseVegetation   | #                                          | nca.ecoregion:RenosterveldShrubland          | #   				|  nca.ecosystem.iucn:SeasonallyDryTemperateHeathShrubland     ,
 landcover:ArableLand	      | #                                          | #									          | #   				|  nca.ecosystem.iucn:AnnualCropland        
 }};

model nca.ecosystem.iucn:EcosystemType named ecosystem_type_iucn_get
	observing
		landcover:LandCoverType          			named landcover,
		rules_based_modelling:ForestType 		named forest_managment,
		type of nca.ecoregion:DinersteinRegion 	named dinerstein_ecoregion                                                                                                      
	lookup 
		(landcover, forest_managment, dinerstein_ecoregion,*, ?) 
			into RULE_BASED_ECOSYSTEM_IUCN_TABLE
			over space(shape='MULTIPOLYGON (((21.44401804077235596 -33.49731133074468659, 21.59794895120490565 -33.50359422504805451, 21.68590947145207792 -33.62611066396375747, 22.02204431668234008 -33.66590232788509951, 22.04298729769357124 -33.94025537913222479, 21.79062437650823369 -33.88685077755358321, 21.49846979140155767 -33.73920276142440855, 21.40658246221477867 -33.64181789972217729, 21.44401804077235596 -33.49731133074468659)))');
			